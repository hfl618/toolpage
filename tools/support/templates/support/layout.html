<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}工具{% endblock %} | 618002.xyz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { background-color: #fbfbfd; font-family: 'Plus Jakarta Sans', sans-serif; font-size: 15px; color: #1d1d1f; -webkit-font-smoothing: antialiased; }
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: saturate(180%) blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .card-apple { background: white; border: 1px solid rgba(226, 232, 240, 0.7); border-radius: 24px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); transition: all 0.3s ease; }
        .lang-switcher { display: flex; gap: 4px; background: #f1f5f9; padding: 4px; border-radius: 100px; }
        .lang-btn { padding: 4px 12px; border-radius: 100px; font-size: 10px; font-weight: 800; cursor: pointer; transition: 0.2s; color: #94a3b8; }
        .lang-btn.active { background: white; color: #0071e3; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10000; pointer-events: none; }
        .custom-toast { pointer-events: auto; padding: 12px 28px; border-radius: 50px; margin-top: 10px; font-size: 14px; font-weight: 700; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: slideDown 0.3s ease; color: white; }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        {% block extra_css %}{% endblock %}
    </style>
</head>
<body>

<div id="toast-container"></div>

<nav class="fixed top-0 w-full z-40 glass-nav h-20 flex items-center px-6">
    <div class="max-w-7xl mx-auto w-full flex justify-between items-center">
        <div class="flex items-center gap-4 cursor-pointer" onclick="location.href='/'">
            <div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white text-xl font-black shadow-lg">{% block app_icon %}6{% endblock %}</div>
            <span class="text-xl font-black tracking-tightest">{% block app_name %}Studio{% endblock %}</span>
        </div>
        
        <div class="flex items-center gap-6">
            {% block nav_search %}{% endblock %}
            <div class="lang-switcher">
                <div onclick="setLanguage('zh')" id="lang-zh" class="lang-btn">中文</div>
                <div onclick="setLanguage('en')" id="lang-en" class="lang-btn">EN</div>
            </div>
            <div id="userArea" class="relative group">
                <div class="animate-pulse w-8 h-8 bg-slate-200 rounded-full"></div>
            </div>
        </div>
    </div>
</nav>

<main class="max-w-7xl mx-auto px-6 pt-32 pb-20">
    {% block content %}{% endblock %}
    
    <div class="mt-12 pt-8 border-t border-slate-100 text-center">
        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest i18n" 
           data-zh="版权声明：本工具生成的代码产权归用户所有，本站不参与任何版权纠纷。数据处理在内存中进行，不留存任何用户资产。" 
           data-en="Copyright Disclaimer: Assets generated belong to the user. We do not store or claim rights to any uploaded content.">
           版权声明：本工具生成的代码产权归用户所有，本站不参与任何版权纠纷。数据处理在内存中进行，不留存任何用户资产。
        </p>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function showToast(msg, type='info') {
        const container = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = 'custom-toast';
        t.style.background = type === 'error' ? '#ef4444' : '#1e293b';
        t.innerText = msg;
        container.appendChild(t);
        setTimeout(() => t.remove(), 3000);
    }

    let currentLang = localStorage.getItem('lang') || (navigator.language.startsWith('zh') ? 'zh' : 'en');

    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('lang', lang);
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.id === 'lang-' + lang));
        document.querySelectorAll('.i18n').forEach(el => { el.innerText = el.getAttribute('data-' + lang); });
        if(typeof onLangChange === 'function') onLangChange();
        syncUser();
    }

    async function syncUser() {
        try {
            const r = await fetch('/auth/profile_api');
            const d = await r.json();
            const area = document.getElementById('userArea');
            if(d.success && d.user) {
                const user = d.user;
                const profileLabel = currentLang === 'zh' ? '个人中心' : 'Profile';
                const logoutLabel = currentLang === 'zh' ? '退出登录' : 'Logout';
                const fromParam = window.location.pathname.split('/')[1] || '';
                const profileUrl = fromParam ? `/profile?from=${fromParam}` : '/profile';
                
                area.innerHTML = `
                    <div class="relative">
                        <div class="flex items-center gap-2 p-1.5 pr-4 rounded-full bg-white border border-gray-100 shadow-sm cursor-pointer hover:bg-slate-50 transition-all" onclick="toggleUserMenu()">
                            <img src="${user.avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + user.username}" class="w-8 h-8 rounded-full object-cover">
                            <span class="text-xs font-bold text-slate-700 hidden md:inline">${user.username}</span>
                            <i class="ri-arrow-down-s-line text-slate-400"></i>
                        </div>
                        <div id="userMenu" class="absolute right-0 mt-3 w-48 bg-white rounded-2xl shadow-2xl border border-gray-100 opacity-0 invisible transition-all p-2 z-50 transform origin-top-right">
                            <div class="px-4 py-2 border-b border-gray-50 mb-1 text-[10px] font-black text-blue-500 uppercase tracking-widest">${user.role} MEMBER</div>
                            <a href="${profileUrl}" class="flex items-center gap-3 px-4 py-2.5 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition no-underline"><i class="ri-user-settings-fill"></i> ${profileLabel}</a>
                            <button onclick="location.href='/logout'" class="w-full flex items-center gap-3 px-4 py-2.5 text-sm font-bold text-red-500 hover:bg-red-50 rounded-xl transition text-left border-0 bg-transparent"><i class="ri-logout-box-fill"></i> ${logoutLabel}</button>
                        </div>
                    </div>`;
            } else {
                const loginLabel = currentLang === 'zh' ? '立即登录' : 'LOGIN';
                area.innerHTML = `<a href="/login.html?next=${window.location.pathname}" class="px-4 py-2 bg-slate-900 text-white rounded-full text-[10px] font-black no-underline hover:bg-slate-800 shadow-lg">${loginLabel}</a>`;
            }
        } catch(e){}
    }

    function toggleUserMenu() {
        const m = document.getElementById('userMenu');
        if(m) { m.classList.toggle('opacity-0'); m.classList.toggle('invisible'); }
    }

    setLanguage(currentLang);
</script>
{% block extra_js %}{% endblock %}
</body>
</html>
